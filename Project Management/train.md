**Отчет по `train.py`**

### Роль скрипта в проекте
`train.py` — **основной скрипт для обучения MLP-регрессора** на эмбеддингах спикера (WeSpeaker).  
Задача: предсказать **скорость речи (букв/сек)** как непрерывное значение (регрессия).  
Выполняется **Задание 2**: обучение MLP на извлечённых эмбеддингах, сохранение модели, получение метрик (MSE/MAE — через `train_probing_model`).

---

### Формат входных данных

| Источник | Путь | Формат |
|--------|------|--------|
| **Эмбеддинги** | `embeddings_npy` | `.npy`-файлы (или ChromaDB) |
| **Лейблы (скорость)** | `data/processed/train_cps.csv` | CSV с колонками: `sample_id`, `cps` (characters per second) |
| **Раздел** | `split="train"` | Указывает, какие строки из CSV использовать |

> `RegressionEmbeddingsDataset` объединяет эмбеддинг и лейбл по `sample_id`.

---

### Поток данных

```
embeddings_npy (.npy) 
       + 
train_cps.csv (cps) 
       → RegressionEmbeddingsDataset 
       → DataLoader (batch_size=32)
       → model (ProbingCls: 256 → 1)
       → MSELoss → Adam
       → train_probing_model() → обученная модель
       → torch.save(model, "models/regression_model.pt")
```

---

### Ключевые параметры

| Параметр | Значение | Назначение |
|--------|----------|-----------|
| `input_dim` | 256 | Размерность эмбеддингов WeSpeaker |
| `criterion` | `nn.MSELoss()` | Регрессия |
| `batch_size` | 32 | Обработка батчами |
| `num_epochs` | 10 | Длительность обучения |
| `source_type` | `"npy"` | Формат хранения эмбеддингов |

---

### Особенности

- Используется **готовый класс `ProbingCls`** (MLP с 1 выходом).
- Обучение через **универсальную функцию `train_probing_model`**.
- Сохраняется **вся модель** (`torch.save(model)`), а не только `state_dict`.

---

### Что делает скрипт по шагам

1. Загружает эмбеддинги + лейблы скорости.
2. Создаёт `DataLoader` с перемешиванием.
3. Инициализирует MLP (вход: 256, выход: 1).
4. Запускает обучение (MSE, Adam).
5. Сохраняет модель в `models/regression_model.pt`.

---

### Вывод

`train.py` — **рабочий конвейер регрессии** по Заданию 2.  
Готов к запуску **после**:
- извлечения эмбеддингов (`extract_embeddings.py`)
- создания `train_cps.csv` с `cps` (`preprocess.py`)

Далее: запустить, получить MSE/MAE, перейти к визуализации и PR.